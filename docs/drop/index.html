<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>WTF?</title>
<style>
body
{
	overflow: hidden;
}


canvas{float:left}
#container{
float:left;
width:800px;
height:700px;
display:block;

}

canvas{margin:0px;padding:0px;border:1px solid green}

</style>
</head>
<body onload="makePlayer()">
<div id="container">

<!-- 80 x 144-->
<!--<canvas class="box2d" id='r0c0'></canvas>-->



</div>

<script src="protoclass.js"></script>
<script src='box2d.js'></script>
<script src='Main.js'></script>

<script type="text/javascript">
var segments = 4;
var elements = new Array();
function makePlayer() {
    var video = document.createElement("video");
    video.id="player";
    video.setAttribute('loop', 'true');
    video.style.display="none";
	video.innerHTML += '<source src="../video/bbb.mp4" type="video/mp4" />';
	video.innerHTML = '<source src="../video/bbb.ogv" type="video/ogg" />';
	video.play();
   	document.body.appendChild(video);
	video.addEventListener('loadedmetadata', function() {
	var video =$("player");
	var w = video.videoWidth;
	var h = video.videoHeight;
	var count=0;
	var container = $("container")
	for(var row=0; row<segments; row++){
		for(var col=0; col<segments; col++){
			var c = document.createElement('canvas');
			c.width=w/segments;
			c.height=h/segments;
			c.id = "r" + row + "c" + col;
			c.setAttribute("class", "box2d");
			elements[count]=c;
			count++;
			console.log("r" + row + "c" + col);
			container.appendChild(c);
		}
	}
	init(elements,w/segments,h/segments);
	setInterval(draw, 10);
	//draw()
	}, false);



    }


    function draw(){
	    var video =$("player");
    	//var c = document.getElementById("c");
		var w = video.videoWidth;
		var h = video.videoHeight;
		//var gw = Math.floor(w/segments);
		//var gh = Math.floor(h/segments);
		var gw = w/segments;
		var gh = h/segments;



		var buffer= 0;
		var ctx ;
		var cell;
		for(var row=0; row<segments; row++){
			//each row
			for(var col=0; col<segments; col++){
			//each column
			//context . drawImage(image, dx, dy)
			//context . drawImage(image, dx, dy, dw, dh)
			//context . drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh
			var sx = col*gw;
			var sy = row*gh;
			var sw = gw;
			var sh = gh;
			var dx = col*gw+(buffer*col);
			var dy = row*gh+(buffer*row);
			var dw = gw;
			var dh = gh;
			cell = $('r' + row + 'c' + col);
			//cell.width=dw;
			//cell.height=dh;

			ctx=cell.getContext('2d');
			console.log('r' + row + 'c' + col)
			ctx.fillStyle    = 'rgba(0, 0, 0, 0.25)';
			ctx.fillRect(dx, dy, dw, dh);
			ctx.drawImage(video,sx, sy, sw, sh, 0, 0, dw, dh);
			//ctx.rotate(buffer / 180);
			}
		}


}

function $(selector) {
    return document.getElementById(selector);
}


</script>


</body>

</html>