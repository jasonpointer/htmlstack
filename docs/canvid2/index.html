<!DOCTYPE html>
<html>
<head>
<title>Canvas + Video</title>
<link  rel="stylesheet" type="text/css" href="../css/site.css" />

<!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<script type="text/javascript">
function makePlayer() {
    var video = document.createElement("video");
    video.id="player";
    video.setAttribute('loop', 'true');
    video.style.display="none";
	video.innerHTML += '<source src="../video/bbb.mp4" type="video/mp4" />';
	video.innerHTML += '<source src="../video/bbb.ogv" type="video/ogg" />';
	video.play();
	var container = document.getElementById('container');
   	container.appendChild(video);
    var c = document.createElement('canvas');
    c.id = "c";

    container.appendChild(c);
	video.addEventListener('loadedmetadata', function() {
		setInterval(draw, 10);
	}, false);



    }


    function draw(){
	    var video = document.getElementById("player");
    	var c = document.getElementById("c");
		var w = video.videoWidth;
		var h = video.videoHeight;
		var segments = 5;
		var gw = Math.floor(w/segments);
		var gh = Math.floor(h/segments);
		//buffer = 10;
		var buffer= document.getElementById('buffer').value;
		var ctx = c.getContext('2d');
		c.width=w+(buffer*segments);
		c.height=h+(buffer*segments);
		for(var row=0; row<segments; row++){
			//each row
			for(var col=0; col<segments; col++){
			//each column
			//context . drawImage(image, dx, dy)
			//context . drawImage(image, dx, dy, dw, dh)
			//context . drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh
			var sx = col*gw;
			var sy = row*gh;
			var sw = gw;
			var sh = gh;
			var dx = col*gw+(buffer*col);
			var dy = row*gh+(buffer*row);
			var dw = gw;
			var dh = gh;
			ctx.fillStyle    = 'rgba(0, 0, 0, 0.25)';
			ctx.fillRect(dx+3, dy+3, dw, dh);
		    ctx.drawImage(video,sx, sy, sw, sh, dx, dy, dw, dh);
			}
		}
}


</script>


<style>

canvas{}
</style>

</head>
  <body onload="makePlayer()">


<header>Canvas + Video 2</header>

<section id="content">
	<article>
		<div id="container"></div>
	</article>

	<article class="description">
  <input id="buffer" name="buffer" type="range" min="0" max="25" value="10">
	<h2>more canvas + video.</h2>
	<p>If someone sent you here and you're not using Chrome, they meant to crash your browser!  Retaliate!  <i>Have not figured out the bug in Safari or Firefox yet for this one.</i></p>


	</article>
</section>

<footer>back to <a href="/">htmlstack</a></footer>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-91014-16");
pageTracker._trackPageview();
} catch(err) {}</script>

</body>
</html>